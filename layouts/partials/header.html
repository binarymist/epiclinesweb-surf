{{ $current_page := . }}
{{ $highlight_active_link := site.Params.main_menu.highlight_active_link | default true }}

<!-- top tabs -->
{{ partial "toptabs.html" . }}

<!-- navigation -->
<header class="sticky-top bg-white">
  <div class="container">
    <nav class="navbar navbar-expand-lg navbar-light">
      <a class="navbar-brand" href="{{ site.BaseURL | relLangURL }}">{{ if site.Params.logo }} <img src="{{ site.Params.logo | absURL }}" alt="{{ site.Title }}" {{with site.Params.logo_width}}width="{{.}}"{{end}}> {{ else }} {{ site.Title }} {{ end }}</a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation"
        aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        <ul class="navbar-nav ml-auto">
          {{ range site.Menus.main }}
          <!-- Replace this with purpleteam-labs-web navbar.html.
          <li class="nav-item">
            <a class="nav-link" href="{{if .Pre}}{{site.BaseURL | relLangURL}}{{.Pre}}{{ .URL }}{{else}}{{.URL | absLangURL}}{{end}}">{{ .Name }}</a>
          </li>
          -->
          
          <!-- Following code taken from purpleteam-labs-web -->
          {{ if .HasChildren }}
          <li class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
              <span>{{ .Name | safeHTML }}</span>
              <span class="caret"></span>
            </a>
            <div class="dropdown-menu">
              {{ range .Children }}
                <a class="dropdown-item" href="{{ .URL | relLangURL }}"{{ if $.IsHome }} data-target="{{ .URL }}"{{ end }}>
                  <span>{{ .Name | safeHTML }}</span>
                </a>
              {{ end }}
            </div>
          </li>

          {{ else }}
  
          {{/* Set target for link. */}}
          {{ with .Params.newTab }}
            {{ if eq . true }}
              {{ $.Scratch.Set "target" " target=\"_blank\" rel=\"noopener\"" }}
            {{ end }}
          {{ end }}
  
          {{/* Get active page. */}}
  
          {{ $is_link_in_current_path := false }}
          {{ $is_widget_page := or $current_page.IsHome (eq $current_page.Type "widget_page") }}
          {{ $is_same_page := false }}
          {{ $hash := findRE "#(.+)" .URL }}
  
          {{ if $current_page.IsHome | and (or (eq .URL "/") (eq .URL "")) }}
            {{ $is_link_in_current_path = true }}
          {{else}}
            {{ if gt (len .URL) 1 }}{{/* Ignore root URL */}}
              {{ $is_link_in_current_path = in $current_page.RelPermalink .URL }}
              {{ $is_same_page = $is_link_in_current_path }}
            {{end}}
            {{ if gt (len $hash) 0 }}
              {{ $hash = index $hash 0 }}
              {{ $hash_removed := replace .URL $hash "" }}
              {{ if eq (len $hash_removed) 0 }}
                {{ $hash_removed = "/" }}{{/* Add robustness for `/#SECTION` or `#SECTION` in `menus.toml`. */}}
              {{ end }}
              {{ $is_same_page = eq (path.Dir $current_page.RelPermalink) (path.Dir ($hash_removed|relLangURL)) }}
            {{ end }}
          {{end}}
  
          <li class="nav-item">
            <a class="nav-link {{if and $highlight_active_link $is_link_in_current_path }} active{{end}}" href="{{.URL | relLangURL}}"{{ if and $is_widget_page $is_same_page }} data-target="{{$hash}}"{{ end }}{{ ($.Scratch.Get "target") | safeHTMLAttr }}>
              <span>{{ .Name | safeHTML }}</span>
            </a>
          </li>
  
          {{ end }}
          {{ end }}

        <!-- End - Following code taken from purpleteam-labs-web -->
        </ul>
        <!-- Language List -->
        <!-- KC: Only need English.
        {{ if .IsTranslated }}
        <select class="lang-list" id="select-language" onchange="location = this.value;">
          {{ $siteLanguages := .Site.Languages}}
          {{ $pageLang := .Page.Lang}}
          {{ range .Page.AllTranslations }}
          {{ $translation := .}}
          {{ range $siteLanguages }}
          {{ if eq $translation.Lang .Lang }}
          {{ $selected := false }}
          {{ if eq $pageLang .Lang}}
          <option id="{{ $translation.Language }}" value="{{ $translation.Permalink }}" selected>{{ .LanguageName }}
          </option>
          {{ else }}
          <option id="{{ $translation.Language }}" value="{{ $translation.Permalink }}">{{ .LanguageName }}</option>
          {{ end }}
          {{ end }}
          {{ end }}
          {{ end }}
        </select>
        {{ end }}
        -->
      </div>
      {{ if site.Params.snipcart.enable}}
      <button class="cart snipcart-checkout"><i class="tf-ion-android-cart"></i><span class="badge badge-primary snipcart-items-count"></span></button>
      {{ end }}
    </nav>
  </div>
</header>
<!-- /navigation -->
